/*! tjzx.ued version:0.1.0 2014-05-10 09:49:49 */
!function(a,b){var c=a(".j-form").valid(),d=a(".s-form").valid({submit:function(){a(".j-search").click()}});c.init(),b.stateArray[0]="停用",b.stateArray[1]="启用";var e=new hTemplate({tmp:a("#h-temp").html(),empty:a("#h-empty").html(),container:a(".j-htemplate"),size:15,pager:a(".h-pager"),pageClick:function(a){f(a-1)},filter:function(a){return a.links='<a href="#" class="j-edit">编辑</a>',0==a.state?a.links+=singer.format('<a href="#" class="j-state" data-state="1">{0}</a>',b.stateArray[1]):1==a.state&&(a.links+=singer.format('<a href="#" class="j-state" data-state="0">{0}</a>',b.stateArray[0])),a},complete:function(){b.setFrameHeight()}}),f=function(c){var f=d.json(),g=a(this);singer.mix(f,{page:c}),b.getJson("/m/member/list",f,function(c){c.state&&(e.bind(c.data.list,c.data.count),a(".m-table caption em").html(c.data.count)),g.hasClass("btn")&&b.setBtn(g,!0)},function(){e.bind()})},g=function(d){var e=a('input[name="userPwd"]');return!d||0>=d?(c.reset(),e.data("rule",{type:"^[\\w\\W]{4,16}$",msg:"请输入4-16位字符！"}),!1):(e.data("rule",""),void b.getJson("/m/member/item",{userId:d},function(d){return d.state?(a(".m-panel-title li").removeClass("active"),a(".m-panel-title ul").append('<li class="m-panel-add active">编辑会员</li>'),a(".j-back").show(),c.bind(d.data),a(".m-panel-item").hide().eq(1).fadeIn(),b.setFrameHeight(),!1):(b.msg(d.msg||"获取会员信息失败！"),!1)}))};f(0),"#send"===location.hash&&a(".m-panel-title li:eq(1)").click(),a(".j-htemplate").delegate(".j-send","click",function(){return a(".m-panel-title li:eq(1)").click(),!1});var h=["Gray","Green"];a(document).delegate(".m-panel-title li:eq(1)","click.form",function(){g()}).delegate(".j-search","click",function(){return a(this).hasClass("disabled")?!1:(b.setBtn(this,!1),f.call(this,0),!1)}).delegate(".j-submit","click",function(){if(a(this).hasClass("disabled")||!c.check())return!1;b.setBtn(this,!1);var d=c.json();return b.getJson("/m/member/add",d,function(a){a.state?b.msg(d.memberId>0?"编辑成功！":"添加成功！","reload"):(b.msg(a.msg||"操作异常！"),b.setBtn(".j-submit",!0))},function(){b.setBtn(".j-submit",!0)}),!1}).delegate(".j-edit","click",function(){var b=a(this).parents("tr").data("id");return g(b),!1}).delegate(".j-state","click",function(){var c=a(this),d=c.parents("tr").data("id"),e=c.data("state");return d&&""!==e?(b.setStateBtn.call(c,!1),b.getJson("/m/member/updateState",{userId:d,state:e},function(a){if(a.state){c.parent().prev().html(singer.format('<span style="color:{color}">已{text}</font>',{color:h[e],text:b.stateArray[e+""]}));var d=Math.abs(e-1);b.setStateBtn.call(c,a,d)}else b.setStateBtn.call(c,a,e)}),!1):!1}).delegate(".j-delete","click",function(){var c=a(this).parents("tr").data("id");return confirm("确认删除该会员？")?(b.getJson("/m/member/delete",{userId:c},function(a){a.state?(b.msg(a.msg||"删除成功！"),location.reload(!0)):b.msg(a.msg||"删除失败，请稍候重试！")}),!1):!1}).delegate(".j-restore","click",function(){var c=a(this).parents("tr").data("id");return confirm("确认还原该会员？")?(b.getJson("/m/member/restore",{userId:c},function(a){a.state?(b.msg(a.msg||"还原成功！"),location.reload(!0)):b.msg(a.msg||"还原失败，请稍候重试！")}),!1):!1})}(jQuery,TJZX);