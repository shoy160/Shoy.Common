/*! tjzx.ued version:0.1.0 2014-05-10 09:49:49 */
!function($,T){T.getJson("/m/album/groups",{state:1},function(a){var b=a.data.list;if(a.state&&b&&b.length>0){for(var c=$("select[name='groupId']"),d="",e=0;e<b.length;e++)d+=singer.format("<option value='{id}'>{name}</option> ",b[e]);c.append(d)}}),$("#fileUp").uploadify({swf:"/uploadify/uploadify.swf",uploader:"/m/album/uploadImage",formData:{albumId:$('input[name="albumId"]').val()},buttonText:"选择文件",fileTypeExts:"*.jpg;*.jpeg;*.gif;*.png",fileTypeDesc:"图片文件",fileSizeLimit:"500k",multi:!1,fileObjName:"fileData",onUploadError:function(){},onUploadSuccess:function(file,json){json=eval("("+json+")"),json&&json.state&&($('input[name="picture"]').val(json.data.url),$(".t-package-img").html(singer.format('<img src="{0}" />',json.data.url)),T.setFrameHeight())},onUploadComplete:function(){}});var vForm=$(".j-form").valid(),sForm=$(".s-form").valid({submit:function(){$(".j-search").click()}});vForm.init(),T.stateArray[0]="隐藏",T.stateArray[1]="显示";var h=new hTemplate({tmp:$("#h-temp").html(),empty:$("#h-empty").html(),container:$(".j-htemplate"),size:15,pager:$(".h-pager"),pageClick:function(a){getList(a-1)},filter:function(a){return a.links='<a href="#" class="j-edit">编辑</a>',0==a.state?a.links+=singer.format('<a href="#" class="j-state" data-state="1">{0}</a>',T.stateArray[1]):1==a.state&&(a.links+=singer.format('<a href="#" class="j-state" data-state="0">{0}</a>',T.stateArray[0])),a},complete:function(){T.setFrameHeight()}}),getList=function(a){var b=sForm.json(),c=$(this);singer.mix(b,{page:a}),T.getJson("/m/album/list",b,function(a){a.state&&(h.bind(a.data.list,a.data.count),$(".m-table caption em").html(a.data.count)),c.hasClass("btn")&&T.setBtn(c,!0)},function(){h.bind()})},loadItem=function(a){return!a||0>=a?(vForm.reset(),!1):void T.getJson("/m/album/item",{albumId:a},function(a){return a.state?($(".m-panel-title li").removeClass("active"),$(".m-panel-title ul").append('<li class="m-panel-add active">编辑相册</li>'),$(".j-back").show(),vForm.bind(a.data),$(".t-package-img").html(singer.format('<img src="{0}" />',a.data.picture)),$(".m-panel-item").hide().eq(1).fadeIn(),T.setFrameHeight(),!1):(T.msg(a.msg||"获取相册信息失败！"),!1)})};getList(0),"#send"===location.hash&&$(".m-panel-title li:eq(1)").click(),$(".j-htemplate").delegate(".j-send","click",function(){return $(".m-panel-title li:eq(1)").click(),!1});var stateColor=["Gray","Green"];$(document).delegate(".m-panel-title li:eq(1)","click.form",function(){loadItem()}).delegate(".j-search","click",function(){return $(this).hasClass("disabled")?!1:(T.setBtn(this,!1),getList.call(this,0),!1)}).delegate(".j-submit","click",function(){if($(this).hasClass("disabled")||!vForm.check())return!1;T.setBtn(this,!1);var a=vForm.json();return T.getJson("/m/album/add",a,function(b){b.state?T.msg(a.packageId>0?"编辑成功！":"添加成功！","reload"):(T.msg(b.msg||"操作异常！"),T.setBtn(".j-submit",!0))},function(){T.setBtn(".j-submit",!0)}),!1}).delegate(".j-edit","click",function(){var a=$(this).parents("td").data("id");return loadItem(a),!1}).delegate(".j-state","click",function(){var a=$(this),b=a.parents("td").data("id"),c=a.data("state");return b&&""!==c?(T.setStateBtn.call(a,!1),T.getJson("/m/album/updateState",{packageId:b,state:c},function(b){if(b.state){a.parent().prev().html(singer.format('<span style="color:{color}">{text}</font>',{color:stateColor[c],text:T.stateArray[c+""]}));var d=Math.abs(c-1);T.setStateBtn.call(a,b,d)}else T.setStateBtn.call(a,b,c)}),!1):!1}).delegate(".j-delete","click",function(){var a=$(this).parents("td").data("id");return confirm("确认删除该相册？")?(T.getJson("/m/album/delete",{packageId:a},function(a){a.state?(T.msg(a.msg||"删除成功！"),location.reload(!0)):T.msg(a.msg||"删除失败，请稍候重试！")}),!1):!1}).delegate(".j-restore","click",function(){var a=$(this).parents("td").data("id");return confirm("确认还原该相册？")?(T.getJson("/m/album/restore",{packageId:a},function(a){a.state?(T.msg(a.msg||"还原成功！"),location.reload(!0)):T.msg(a.msg||"还原失败，请稍候重试！")}),!1):!1})}(jQuery,TJZX);