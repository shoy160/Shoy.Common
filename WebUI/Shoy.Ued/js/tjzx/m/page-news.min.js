/*! tjzx.ued version:0.1.0 2014-05-10 09:49:49 */
!function(a,b){var c=a(".j-form").valid(),d=a(".s-form").valid({submit:function(){a(".j-search").click()}});c.init();var e=new hTemplate({tmp:a("#h-temp").html(),empty:a("#h-empty").html(),container:a(".j-htemplate"),size:15,pager:a(".h-pager"),pageClick:function(a){f(a-1)},filter:function(a){return a.links='<a href="#" class="j-edit">编辑</a>',0==a.state?a.links+='<a href="#" class="j-state" data-state="1">显示</a>':1==a.state&&(a.links+='<a href="#" class="j-state" data-state="0">隐藏</a>'),a.type<100&&(a.links+=a.recommend?'<a href="#" class="j-recommend" data-state="0">取消置顶</a>':'<a href="#" class="j-recommend" data-state="1">置顶</a>'),a.recommend&&(a.title+='<span style="color: Red;padding-left: 6px">[置顶]</span>'),a},complete:function(){b.setFrameHeight()}}),f=function(c){var f=d.json(),g=a(this);singer.mix(f,{page:c}),b.getJson("/m/news/list",f,function(c){c.state&&(e.bind(c.data.list,c.data.count),a(".m-table caption em").html(c.data.count)),g.hasClass("btn")&&b.setBtn(g,!0)})},g=function(d){return!d||0>=d?(c.reset(),h.setContent(""),!1):void b.getJson("/m/news/item",{newsId:d},function(d){return d.state?(a(".m-panel-title li").removeClass("active"),a(".m-panel-title ul").append('<li class="m-panel-add active">编辑资讯</li>'),c.bind(d.data),h.setContent(d.data.content),a(".m-panel-item").hide().eq(1).fadeIn(),b.setFrameHeight(),!1):(b.msg(d.msg||"获取资讯信息失败！"),!1)})};f(0),window.UEDITOR_CONFIG.autoHeightEnabled=!1;var h=UE.getEditor("content");"#send"===location.hash&&a(".m-panel-title li:eq(1)").click(),a(".j-htemplate").delegate(".j-send","click",function(){return a(".m-panel-title li:eq(1)").click(),!1});var i=["隐藏","显示"],j=["Gray","Green"];a(document).delegate(".m-panel-title li:eq(1)","click.form",function(){g()}).delegate(".j-search","click",function(){return a(this).hasClass("disabled")?!1:(b.setBtn(this,!1),f.call(this,0),!1)}).delegate(".j-release","click",function(){if(a(this).hasClass("disabled")||!c.check())return!1;var d=encodeURIComponent(h.getContent());if(""==d||null==d)return b.msg("请填写资讯内容！"),!1;b.setBtn(this,!1);var e=c.json();return e.content=d,b.getJson("/m/news/add",e,function(a){a.state?b.msg(e.newsId>0?"编辑成功！":"发布成功！","reload"):(b.msg(a.msg||"操作异常！"),b.setBtn(".j-release",!0))},function(){b.setBtn(".j-release",!0)}),!1}).delegate(".j-edit","click",function(){var b=a(this).parents("tr").data("id");return g(b),!1}).delegate(".j-state","click",function(){var c=a(this),d=c.parents("tr").data("id"),e=c.data("state");return d&&""!==e?(b.setStateBtn.call(c,!1),b.getJson("/m/news/updateState",{newsId:d,state:e},function(a){if(a.state){c.parent().prev().html(singer.format('<span style="color:{color}">{text}</font>',{color:j[e],text:i[e]}));var d=Math.abs(e-1);b.setStateBtn.call(c,a,d)}else b.setStateBtn.call(c,a,e)}),!1):!1}).delegate(".j-recommend","click",function(){var c=a(this).parents("tr").data("id"),d=a(this).data("state");return b.getJson("/m/news/recommend",{newsId:c,recommend:d},function(a){a.state?Alert(a.msg||(d?"置顶成功！":"取消置顶成功！"),function(){f.call(this,0)}):b.msg(a.msg||"操作失败，请稍候重试！")}),!1}).delegate(".j-delete","click",function(){var c=a(this).parents("tr").data("id");return Confirm("确认删除该资讯？")?(b.getJson("/m/news/delete",{newsId:c},function(a){a.state?(b.msg(a.msg||"删除成功！"),location.reload(!0)):b.msg(a.msg||"删除失败，请稍候重试！")}),!1):!1}).delegate(".j-restore","click",function(){var c=a(this).parents("tr").data("id");return Confirm("确认还原该资讯？")?(b.getJson("/m/news/restore",{newsId:c},function(a){a.state?(b.msg(a.msg||"还原成功！"),location.reload(!0)):b.msg(a.msg||"还原失败，请稍候重试！")}),!1):!1})}(jQuery,TJZX);